<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>El Jard√≠n de los Recuerdos</title>
  <style>
    :root {
      --bubble-w: 260px;
      --bottom-space: 180px;
    }
    html, body {
      height:100%;
      margin:0;
      font-family: system-ui, Arial, sans-serif;
      background: url("https://cdn.pixabay.com/photo/2015/06/19/21/24/avenue-815297_1280.jpg") center center/cover no-repeat fixed;
      background-color: rgba(255,255,255,0.6);
      background-blend-mode: lighten;
    }
    /* START */
    #start-screen {
      position:fixed; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
      background: rgba(255,255,255,0.8);
      z-index: 400;
      padding:20px; box-sizing:border-box;
    }
    #start-screen h1 { margin:0 0 12px; font-size:2.1rem; text-align:center; color:#2b6a36; }
    .btn { padding:12px 20px; border-radius:12px; border:0; cursor:pointer; background:#57b86a; color:#fff; font-size:1rem; }
    .btn:active { transform: scale(.98); }

    /* GAME */
    #game-container { display:none; padding:18px; box-sizing:border-box; min-height:100vh; }
    header.appbar { display:flex; justify-content:center; align-items:center; margin-bottom:8px; }
    header.appbar h2 { margin:0; color:#2b6a36; text-shadow: 1px 1px 2px rgba(255,255,255,0.8); }

    .hud { display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:8px; color:#1e6b2a; text-shadow: 1px 1px 2px rgba(255,255,255,0.8); }
    .score { font-weight:700; }

    #elements { display:flex; flex-wrap:wrap; justify-content:center; gap:18px; padding-bottom: var(--bottom-space); }

    .cell {
      width:140px; height:140px; border-radius:14px; background:#ffffffcc;
      display:flex; align-items:center; justify-content:center;
      font-size:56px; box-shadow:0 6px 18px rgba(0,0,0,0.08);
      touch-action: manipulation; user-select:none; -webkit-user-select:none;
    }
    .cell.highlight { background:#c6f6d5; transform: scale(1.03); transition: transform .12s; }

    /* Jardinero */
    #gardener-wrapper {
      position:fixed; right:12px; bottom:12px; display:flex; flex-direction:column; align-items:center; gap:10px;
      z-index: 900; pointer-events:none;
    }
    #speech-bubble {
      width: var(--bubble-w); max-width: 85vw; background: rgba(255,255,255,0.96);
      border:2px solid #3f3f3f; border-radius:14px; padding:10px; font-size:18px; text-align:center;
      box-shadow:0 8px 20px rgba(0,0,0,0.12);
    }
    #gardener-img { width:110px; height:auto; display:block; }

    .overlay { position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:800; background: rgba(255,255,255,0.95); }
    .overlay h2 { margin:0 0 8px; color:#2b6a36; }

    @media (max-width:520px){
      .cell { width:120px; height:120px; font-size:48px; }
      #speech-bubble { font-size:16px; width: 200px; }
      #gardener-img { width:90px; }
      :root { --bottom-space: 150px; }
    }
  </style>
</head>
<body>

  <!-- START -->
  <div id="start-screen" role="dialog" aria-modal="true">
    <h1>üå≥ El Jard√≠n de los Recuerdos üå≥</h1>
    <p style="max-width:560px;text-align:center;color:#2b6a36;">Ayuda al jardinero a cuidar su jard√≠n recordando y repitiendo secuencias. (2 secuencias por ronda)</p>
    <div style="margin-top:14px;">
      <button id="startBtn" class="btn">üå∏ Comenzar Juego</button>
      <button id="musicToggleStart" class="btn" style="background:#6ca3f5;margin-left:10px;">üîä M√∫sica</button>
    </div>
  </div>

  <!-- GAME -->
  <div id="game-container">
    <header class="appbar"><h2>El Jard√≠n de los Recuerdos</h2></header>
    <div class="hud">
      <div class="score" id="scoreDisplay">Puntos: 0</div>
      <div class="lives" id="livesDisplay">Vidas: üå∏üå∏üå∏</div>
    </div>

    <main id="elements"></main>

    <div style="margin-top:12px; display:flex; justify-content:center; gap:10px;">
      <button id="restartBtn" class="btn" style="background:#f6a45d;">üîÑ Reiniciar</button>
      <button id="musicToggleGame" class="btn" style="background:#6ca3f5;">üîä M√∫sica</button>
    </div>
  </div>

  <!-- Jardinero -->
  <div id="gardener-wrapper">
    <div id="speech-bubble">¬°Bienvenido al Jard√≠n!</div>
    <img id="gardener-img" src="https://cdn.pixabay.com/photo/2014/04/02/10/57/gardener-303491_1280.png" alt="Jardinero">
  </div>

  <!-- Overlays -->
  <div id="winOverlay" class="overlay">
    <div>
      <h2>üåü ¬°Gracias por jugar! üåü</h2>
      <p>Siempre eres bienvenido en el Jard√≠n de los Recuerdos üåº</p>
      <div style="margin-top:12px;"><button id="winRestart" class="btn">Volver a jugar</button></div>
    </div>
  </div>

  <div id="loseOverlay" class="overlay">
    <div>
      <h2>üí™ ¬°√Ånimo! üí™</h2>
      <p>Int√©ntalo otra vez, el jard√≠n te espera.</p>
      <div style="margin-top:12px;"><button id="loseRestart" class="btn">Reintentar</button></div>
    </div>
  </div>

  <!-- Audio -->
  <audio id="bgMusic" loop src="https://files.freemusicarchive.org/storage-freemusicarchive-org/music/ccCommunity/Jahzzar/Traveller/Jahzzar_-_05_-_Siesta.mp3"></audio>
  <audio id="sndSequence" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>
  <audio id="sndCorrect" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
  <audio id="sndError" src="https://actions.google.com/sounds/v1/cartoon/metal_thud_and_clang.ogg"></audio>

<script>
const icons = ["üåπ","üåª","üå∑","üçé","üçä","üçì","ü•ï","üçÜ"];
const sndSequence = document.getElementById("sndSequence");
const sndCorrect = document.getElementById("sndCorrect");
const sndError = document.getElementById("sndError");
const bgMusic = document.getElementById("bgMusic");

let score = 0, lives = 3, round = 1;
let sequence = [], playerSeq = [];
let seqIndex = 0, showing = false, musicOn = false;

const elements = document.getElementById("elements");
const scoreDisplay = document.getElementById("scoreDisplay");
const livesDisplay = document.getElementById("livesDisplay");
const speechBubble = document.getElementById("speech-bubble");

function updateHUD(){
  scoreDisplay.textContent = "Puntos: " + score;
  livesDisplay.textContent = "Vidas: " + "üå∏".repeat(lives);
}
function showMessage(msg){
  speechBubble.textContent = msg;
}
function randomIcon(){ return icons[Math.floor(Math.random()*icons.length)]; }

function playSequence(seq){
  showing = true;
  let i = 0;
  const interval = setInterval(()=>{
    if(i<seq.length){
      const cell = elements.children[i];
      cell.classList.add("highlight");
      sndSequence.play();
      setTimeout(()=>cell.classList.remove("highlight"),500);
      i++;
    } else {
      clearInterval(interval);
      showing = false;
      playerSeq = [];
      seqIndex = 0;
    }
  },1000);
}

function nextRound(){
  if(lives<=0){
    document.getElementById("loseOverlay").style.display="flex";
    return;
  }
  if(round>3){
    document.getElementById("winOverlay").style.display="flex";
    return;
  }
  elements.innerHTML="";
  icons.forEach((ic,idx)=>{
    const div=document.createElement("div");
    div.className="cell";
    div.textContent=ic;
    div.dataset.index = idx;
    div.addEventListener("click",()=>handleClick(idx));
    elements.appendChild(div);
  });
  sequence=[];
  for(let i=0;i<round+1;i++) sequence.push(Math.floor(Math.random()*icons.length));
  showMessage(`Ronda ${round}: ¬°Observa bien la secuencia!`);
  setTimeout(()=>playSequence(sequence),1200);
}

function handleClick(idx){
  if(showing) return;
  if(sequence[seqIndex]===idx){
    sndCorrect.play();
    seqIndex++;
    if(seqIndex===sequence.length){
      score+=10;
      updateHUD();
      round++;
      setTimeout(()=>nextRound(),1200);
    }
  } else {
    sndError.play();
    lives--;
    updateHUD();
    if(lives<=0){
      document.getElementById("loseOverlay").style.display="flex";
    } else {
      showMessage("¬°Oh no! Intenta de nuevo.");
      setTimeout(()=>playSequence(sequence),1200);
    }
  }
}

function startGame(){
  score=0; lives=3; round=1;
  updateHUD();
  document.getElementById("start-screen").style.display="none";
  document.getElementById("game-container").style.display="block";
  toggleMusic();
  nextRound();
}

function restartGame(){
  document.getElementById("loseOverlay").style.display="none";
  document.getElementById("winOverlay").style.display="none";
  startGame();
}

async function toggleMusic(){
  if(musicOn){
    bgMusic.pause();
    musicOn=false;
  } else {
    try { await bgMusic.play(); musicOn=true; } 
    catch(e){ console.log("Bloqueo de m√∫sica:", e); }
  }
}

document.getElementById("startBtn").addEventListener("click", startGame);
document.getElementById("restartBtn").addEventListener("click", restartGame);
document.getElementById("winRestart").addEventListener("click", restartGame);
document.getElementById("loseRestart").addEventListener("click", restartGame);
document.getElementById("musicToggleStart").addEventListener("click", toggleMusic);
document.getElementById("musicToggleGame").addEventListener("click", toggleMusic);

updateHUD();
</script>
</body>
</html>
